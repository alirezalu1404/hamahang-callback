<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>هماهنگ | Actions</title>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background: #0f172a;
      color: #f8fafc;
      max-width: 720px;
      margin: 40px auto;
      text-align: center;
      line-height: 1.8;
    }
    code { background:#1e293b; padding:3px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <h2>⚙️ اتصال هماهنگ به دیوار</h2>
  <p>در حال ارسال درخواست به GitHub...</p>
  <pre id="result">...</pre>

  <script>
    async function triggerGithubDispatch() {
      try {
        const response = await fetch(
          "https://api.github.com/repos/alirezalu1404/hamahang-callback/dispatches",
          {
            method: "POST",
            headers: {
              "Accept": "application/vnd.github.v3+json",
              "Authorization": "token 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",
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              event_type: "kenar_message_created",
              client_payload: { source: "divar", status: "ping" }
            })
          }
        );

        if (response.ok) {
          document.getElementById("result").textContent = "✅ درخواست با موفقیت ارسال شد (200 OK)";
        } else {
          const txt = await response.text();
          document.getElementById("result").textContent =
            `❌ خطا: ${response.status}\n\n${txt}`;
        }
      } catch (err) {
        document.getElementById("result").textContent = "❌ خطا در اتصال: " + err.message;
      }
    }

    triggerGithubDispatch();
  </script>
</body>
</html>
